> [GITHUB : mindslab-ai/cotatron](https://github.com/mindslab-ai/cotatron) ì˜ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

âœ… `cotatron_trainer.py ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…`

## Tensorboard
ref : [# TENSORBOARDë¡œ ëª¨ë¸, ë°ì´í„°, í•™ìŠµ ì‹œê°í™”í•˜ê¸°](https://tutorials.pytorch.kr/intermediate/tensorboard_tutorial.html)

* **tensorboard ë¥¼ ì´ìš©í•´ logs í´ë”ì— ê¸°ë¡ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì›¹í˜ì´ì§€ì— ê·¸ë˜í”„ì™€ ì´ë¯¸ì§€ë¥¼ ë„ì›ë‹ˆë‹¤.**
    > ğŸ’¡ ì›¹ìœ¼ë¡œ í•™ìŠµ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

|
* **install check**

	`pip show tensorboard`

	ex)
	```
	(eui_base) {current path}$ pip show tensorboard
	Name: tensorboard
	Version: 2.3.0
	Summary: TensorBoard lets you watch Tensors Flow
	Home-page: https://github.com/tensorflow/tensorboard
	Author: Google Inc.
	Author-email: packages@tensorflow.org
	License: Apache 2.0
	Location: /home/ic-ai/anaconda3/envs/eui_base/lib/python3.6/site-packages
	Requires: setuptools, markdown, numpy, protobuf, grpcio, google-auth, tensorboard-plugin-wit, google-auth-oauthlib, requests, absl-py, werkzeug, wheel, six
	Required-by: pytorch-lightning

|
* **logs structure**
	```
	(your custom path)
		(run name)
			(version_0)
				00000
					metadata.tsv
					tensors.tsv
				00028
				00057
				...
				events.out.tfevents.1605085885.ic-ai.12457
				meta_tags.csv
				projector_config.pbtxt
			(version_1)
			(version_2)
			...
	```
	> ì—¬ê¸°ì„œ 00028, 00057~ ë¡œ ëŠ˜ì–´ë‚˜ëŠ” ì´ìœ ëŠ” ì´ case ì—ì„œ batch size ê°€ 28ì´ì—ˆê¸° ë–„ë¬¸.

## Logging

* **torch.utils.tensorboard.SummaryWriter**

	ex)
	```
	from torch.utils.tensorboard import SummaryWriter

	writer = SummaryWriter('runs/fashion_mnist_experiment_1')

	...

	writer.add_image('four_fashion_mnist_images', img_grid)
	```

|
* **SummaryWriter Method**
	```
	add_scalar
	add_figure
	add_image
	add_graph
	add_embedding
	...
	```

## RUN
* **Run tensorboard**
	```
	tensorboard --logdir {storage_path} --bind_all --port {port_num}
	```
	ex)
	```
	tensorboard --logdir logs/cota --bind_all --port 8087
	```
	> --bind_all ì„ ë„£ì–´ì•¼ ë¡œì»¬ì´ ì•„ë‹Œ ì™¸ë¶€ì—ì„œë„ ì ‘ì†í•  ìˆ˜ ìˆìŒ


|
* **Open URL**
	```
	{Protocol}://{yout server ip address}:{tensorboard port number}
	```
	ex)
	```
	http://219.254.222.222:8087
	```

## Log Process

* **TacotronLogger ê°ì²´ ìƒì„±**
	```
	# in cotatron_trainer.py
	
	tb_logger = TacotronLogger(
		save_dir=hp.log.log_dir,
		name=args.name,
	)	
	```
	> ì—¬ê¸°ì„œ ì…ë ¥ê°’ìœ¼ë¡œ ë“¤ì–´ê°„ **log_dir(cota config ì—ì„œ ì„¤ì •)** ê²½ë¡œ ì•„ë˜ì— **run name(ì‹¤í–‰í•  ë•Œ argument ë¡œ ì„¤ì •)** ë¥¼ í´ë”ëª…ìœ¼ë¡œ í•˜ì—¬ logs ìƒì„±ë¨.

|
* **trainer ì— ë§¤ê°œë³€ìˆ˜ë¡œ tb_logger ë¥¼ ë„˜ê¹€.  trainer ì—ì„œ í•™ìŠµí•˜ëŠ” model ì€ self.logger ë¡œ ë¡œê±°ì— ì ‘ê·¼**
	```
	# in cotatron_trainer.py
	
	model=Cotatron(args)
	...(ìƒëµ)
	trainer = Trainer(
		logger=tb_logger
		...(ìƒëµ)
	)
	trainer.fit(model)
	```

|
* **í•™ìŠµ ì¤‘ cotatron ê°ì²´ì—ì„œ ë¡œê·¸ê¸°ë¡ì„ ìœ„í•´ logger ì˜ ë©”ì†Œë“œ ì‹¤í–‰**

	ex)
	```
	# in cotatron.py , def training_step
	
	self.logger.log_loss(loss_rec, mode='train', step=self.global_step, name='reconstruction')
	```
	```
	# in utils/loggers.py, class TacotronLogger(TensorBoardLogger)
		
	def  log_loss(self, loss, mode, step, name=''):
		name =  '.loss'  + (''  if name==''  else  '_'+name)
		self.experiment.add_scalar(mode + name, loss, step)
	```

|
* **ìƒì†ë°›ì€ í´ë˜ìŠ¤ì¸ pytorch_lightning.loggers.TensorBoardLogger ** ì˜experiemnt ë©”ì†Œë“œê°€ SummaryWriter ê°ì²´ ë°˜í™˜**
	```
	# in pytorch_lightning.loggers.tensorboard.py, TensorBoardLogger
	
	def experiment(self) -> SummaryWriter:
		...
	```
    > **TacotronLogger ì˜ self.experiment.~ ê°€ Summary writer ì˜ ë©”ì†Œë“œ ì‹¤í–‰ì¸ ì…ˆ**

## Result
* **graph**

    _
    ![tensorboard](https://gitlab.com/hanish3464/voice-conversion/uploads/fcac16acf3be06d3a6540dc99c47bea3/tensorboard.PNG)
* **figure**

    _
    ![tensorboard2](https://gitlab.com/hanish3464/voice-conversion/uploads/08e086a1cee93c4716aa13072fbb81f6/tensorboard2.PNG)
